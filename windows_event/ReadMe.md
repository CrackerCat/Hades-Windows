#### 方案：

&emsp;&emsp;Win10 x64内核数据采集，Intel-x虚拟化可以绕过PG保护做花式Hook，风险高，功能强大-系统无痕。微型过滤框架能强大兼容性好，系统回调函数有一定限制，中规中矩。

&emsp;&emsp;方案使用Minifilter框架作为文件采集事件(已舍弃不做主防和隔离)，回调采集内核事件，网络采集WFP。

&emsp;&emsp;该示例适用Win7/Win8/Win10 x64下内核态数据采集，稍作修改就可以在Win7 x32下运行。

#### 框架:
![image](https://github.com/theSecHunter/Hades/blob/main/windows_event/image-20210923092521040.png)

##### WFP：

| 网络层       | API           | 描述  |
| :--------- | :------------ | :---- |
| ALE层 | 0 | 采集进程事件 |
| 传输层     | 0 | TCP - UDP |
| 网络层     | 0     | IP - ICMP |
| 数据链路层 | 0     | MAC - ARP > Win10|

##### 内核回调上抛事件：

| 事件   | API           | 描述  |
| :----- | :------------ | :---- |
| 进程   | 0 | 进程创建 - 销毁 - 进程数据 |
| 线程   | 0      | 线程创建 - 销毁 - 线程数据  |
| 注册表 | 0      | 删除 -  修改 -枚举 - 重命名等    |
| 驱动 | 0      | 加载 - 卸载 - 签名    |
| WMI | 0     | 接口 - 命令  |
| 文件 | 0     | 读 - 写   |

##### 内核接口采集事件：

| 事件       | API           | 描述  |
| :----------- | :------------ | :---- |
| 进程 - 线程 - Image | 0 | 系统当前进程 - 线程 - Image |
| SSDT     | 0      | 系统SSDT表    |
| IDT     | 0      | 系统IDT表    |
| 驱动     | 0      | 系统已加载驱动    |
| 内存     | 0      | 系统内存    |
| 注册内核回调     | 0     | 系统已注册回调    |

